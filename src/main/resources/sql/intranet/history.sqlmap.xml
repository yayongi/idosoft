<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="history">
	<!-- 이력 등록 -->
	<insert id="insert" parameterType="hashmap">
		INSERT INTO TB_MEM_HIST 
			(MEMBER_NO, PROJECT_NO, PROJECT_NM, INSTT_CODE, INSTT_NM, INPT_BGNDE, INPT_ENDDE,
			ROLE_CODE, CHRG_JOB, USE_LANG, REG_DATETIME, UPD_DATETIME, REG_ID,
			UPD_ID, NOTE, TEMP_COLUM)		
		VALUES 
			(#{MEMBER_NO}, #{PROJECT_NO}, #{PROJECT_NM}, #{INSTT_CODE}, #{INSTT_NM}, #{INPT_BGNDE}, #{INPT_ENDDE}, #{ROLE_CODE}, #{CHRG_JOB}, #{USE_LANG}
			, DATE_FORMAT(NOW(),'%Y%m%d'), null, #{REG_ID}, null, "", "")
	</insert>
	
	<!-- 이력 수정 -->
	<update id="update" parameterType="hashmap">
		UPDATE
			TB_MEM_HIST
		SET
			, PROJECT_NM = #{PROJECT_NM}
			, INSTT_CODE = #{INSTT_CODE}
			, INSTT_NM = #{INSTT_NM}
			, INPT_BGNDE = #{INPT_BGNDE}
			, INPT_ENDDE = #{INPT_ENDDE}
			, ROLE_CODE = #{ROLE_CODE}
			, CHRG_JOB = #{CHRG_JOB}
			, USE_LANG = #{USE_LANG}
			, UPD_DATETIME = DATE_FORMAT(NOW(),'%Y%m%d')
			, UPD_ID = #{UPD_ID}
		WHERE
			MEM_HIST_NO = #{MEMBER_NO}
	</update>
	
	
	<!-- 이력 조회 -->
	<select id="selectHistory" parameterType="String"  resultType="hashMap">
		SELECT
			HIST.MEM_HIST_NO
        , HIST.MEMBER_NO
        , HIST.PROJECT_NO
        , HIST.PROJECT_NM
        , HIST.INSTT_CODE
        , HIST.INSTT_NM
        , HIST.INPT_BGNDE
        , HIST.INPT_ENDDE
        , HIST.ROLE_CODE
        , HIST.CHRG_JOB
        , HIST.USE_LANG
        , HIST.REG_DATETIME
        , HIST.UPD_DATETIME
        , HIST.REG_ID
        , HIST.UPD_ID
        , HIST.NOTE
        , HIST.TEMP_COLUM
        , MEM.NAME AS MEMBER_NAME
		FROM TB_MEM_HIST AS HIST
		LEFT JOIN TB_MEMBER AS MEM ON MEM.MEMBER_NO = HIST.MEMBER_NO 
		WHERE 1 = 1
		<if test="MEMBER_NO != ''">
			AND HIST.MEMBER_NO like #{MEMBER_NO}
		</if>
		ORDER BY HIST.INPT_BGNDE DESC
	</select>
</mapper>